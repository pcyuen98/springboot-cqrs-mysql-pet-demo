<app-header></app-header>

<ion-content class="ion-padding">

  <!-- Header & Actions -->
  <div class="ion-padding">
    <ion-grid>
      <ion-row class="ion-align-items-center">

        <!-- Title -->
        <ion-col size="6">
          <h1 class="ion-margin-top ion-margin-bottom" style="font-weight: bold; font-size: 2rem; color: #2563eb;">
            <ion-icon name="paw-outline" style="font-size: 2.5rem; vertical-align: middle; margin-right: 8px;">
            </ion-icon>
            Pets Management
          </h1>
        </ion-col>

        <!-- Search by ID -->
        <ion-col size="2">
          <ion-item>
            <ion-label position="floating">Search by ID</ion-label>
            <ion-input #petId type="number"></ion-input>
          </ion-item>
        </ion-col>

        <!-- Status Dropdown -->
        <ion-col size="2">
          <ion-item>
            <ion-select placeholder="Select Status" (ionChange)="searchPetsByStatus($event.detail.value)">
              <ion-select-option *ngFor="let s of petStatuses" [value]="s">
                {{ s }}
              </ion-select-option>
            </ion-select>
          </ion-item>
        </ion-col>

        <!-- Buttons -->
        <ion-col size="2" class="ion-text-right">
          <ion-button color="primary" (click)="search(petId.value)">
            <ion-icon name="search-outline" slot="start"></ion-icon>
            Search
          </ion-button>
          <ion-button color="success" (click)="onAddPet()">
            <ion-icon name="add-circle-outline" slot="start"></ion-icon>
            Add Pet
          </ion-button>
        </ion-col>

      </ion-row>
    </ion-grid>
  </div>






  <!-- Pets List -->
  <ion-card *ngIf="pets.length">
    <ion-card-content>
      <ion-grid>
        <!-- Table Header -->
        <ion-row class="header-row">
          <ion-col size="1"><strong>#</strong></ion-col>
          <ion-col size="3"><strong>Name</strong></ion-col>
          <ion-col size="2"><strong>Status</strong></ion-col>
          <ion-col size="2"><strong>Category ID</strong></ion-col>
          <ion-col size="2"><strong>Tags</strong></ion-col>
          <ion-col size="2" class="ion-text-center"><strong>Actions</strong></ion-col>
        </ion-row>

        <!-- Table Rows -->
        <ion-row *ngFor="let pet of pets">
          <ion-col size="1">{{ pet.petId ?? 'N/A' }}</ion-col>
          <ion-col size="3">{{ pet.name }}</ion-col>
          <ion-col size="2">
            <ion-badge color="success" *ngIf="pet.status === 'AVAILABLE'">Available</ion-badge>
            <ion-badge color="warning" *ngIf="pet.status === 'PENDING'">Pending</ion-badge>
            <ion-badge color="danger" *ngIf="pet.status === 'SOLD'">Sold</ion-badge>
          </ion-col>
          <ion-col size="2">{{ pet.category?.id }}</ion-col>
          <ion-col size="2">{{ getTagIds(pet) }}</ion-col>
          <ion-col size="2" class="ion-text-center">
            <ion-button fill="clear" color="primary" (click)="onEditPet(pet)">
              <ion-icon slot="icon-only" name="create-outline"></ion-icon>
            </ion-button>
            <ion-button fill="clear" color="danger" (click)="onDeletePet(pet)">
              <ion-icon slot="icon-only" name="trash-outline"></ion-icon>
            </ion-button>
          </ion-col>
        </ion-row>
      </ion-grid>
    </ion-card-content>
  </ion-card>

  <!-- Add/Edit/Delete Form -->
  <ion-card *ngIf="action !== actions.View">
    <ion-card-header>
      <ion-card-title class="ion-text-center">
        {{ action === actions.Add ? 'Add New Pet' : (action === actions.Edit ? 'Edit Pet' : 'Delete Pet') }}
      </ion-card-title>
    </ion-card-header>
    <ion-card-content>

      <!-- Add/Edit Form -->
      <form *ngIf="action === actions.Add || action === actions.Edit" [formGroup]="form" (ngSubmit)="onSubmitPet()">

        <ion-item>
          <ion-label position="floating">Name</ion-label>
          <ion-input type="text" formControlName="name"></ion-input>
        </ion-item>
        <ion-item>
          <ion-label position="floating">Category ID</ion-label>
          <ion-input type="number" formControlName="categoryId"></ion-input>
        </ion-item>
        <ion-item>
          <ion-label position="floating">Tag ID</ion-label>
          <ion-input type="number" formControlName="tagId"></ion-input>
        </ion-item>
        <ion-item>
          <ion-label>Status</ion-label>
          <ion-select formControlName="status" interface="popover" placeholder="Select Status">
            <ion-select-option *ngFor="let s of petStatuses" [value]="s">
              {{ s }}
            </ion-select-option>
          </ion-select>
        </ion-item>
        <ion-item>
          <ion-label position="floating">Photo URL</ion-label>
          <ion-input type="text" formControlName="photoUrl"></ion-input>
        </ion-item>

        <div class="ion-text-center ion-margin-top">
          <ion-button type="submit" [disabled]="form.invalid" color="primary">Save</ion-button>
          <ion-button type="button" color="medium" (click)="cancel()">Cancel</ion-button>
        </div>
      </form>

      <!-- Delete Confirmation -->
      <div *ngIf="action === actions.Delete && selectedPet" class="ion-text-center">
        <p class="ion-margin-top">
          You are about to delete
          <strong>{{ selectedPet.name }} (ID: {{ selectedPet.petId ?? 'N/A' }})</strong>.
        </p>
        <p class="ion-margin-bottom"><strong>Are you sure?</strong></p>
        <div>
          <ion-button color="danger" (click)="deletePet()">Delete</ion-button>
          <ion-button color="medium" (click)="cancel()">Cancel</ion-button>
        </div>
      </div>

    </ion-card-content>
  </ion-card>

</ion-content>

<app-footer></app-footer>
